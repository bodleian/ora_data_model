<xwalkout:consolidated-maps xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:metsrights="http://cosimo.stanford.edu/sdr/metsrights/" xmlns:ora="http://ora/terms/" xmlns:ora_admin="http://ora.ox.ac.uk/vocabs/admin" xmlns:ora_dataset="https://ora.ox.ac.uk/vocabs/dataset" xmlns:ora_open_access_admin="http://ora.ox.ac.uk/vocabs/open_access_admin" xmlns:ora_patent="https://ora.ox.ac.uk/vocabs/patent" xmlns:rioxxterms="http://www.rioxx.net/schema/v2.0/rioxx/" xmlns:uketd_dc="http://naca.central.cranfield.ac.uk/ethos-oai/2.0/" xmlns:uketdterms="http://naca.central.cranfield.ac.uk/ethos-oai/terms/" xmlns:xwalk="http://www.symplectic.co.uk/elements/xwalkcommon" xmlns:xwalkout="http://www.symplectic.co.uk/elements/xwalkout">
  <!--

ISSUES
Can't set citation _place_of_publication from place-of-publication if value else location since citation _place_of_publication canlt have a conditional within it. Limitation of crosswalk.

#To note

Will crosswalk any external identifiers to Hyrax with a new type - check. e.g. abcd:1234 -> <identifier type="abcd">1234</identifier>


-->
  <!--CHANGELOG
Initial changes not logged.
10/12/19: Added apc value map (upper to lower case boolean)
09/12/19: Set placeTerm to come from location rather than place-of-publicaiton (pending answer to GitHub #88)
06/12/2019:
- Added logic for software-markup (to account for version)
- Added patent awarded date (ora_patent: awarded_date)
- location debugged for dataset
- isidoc added to value map fo rexternal identifiers
28/11/19:
- Debugged funder grant ID frm funding acknowledgments
- Debugged user affiliation code
Removed incorrect crosswalks form publisher-url (if device/product -> manufacturer_website_url else publication _website_url)
27/11/19:
- Deleted series -> series _number, added series -> series_title
- deleted duplicate code in journal-article markup (already in common fields markup
- updated journal markup to not repeat relatedItem
26/11/19:
- Added chapter to book markup (rather then repeat all code in chapter markup) and excluded relatedItem form book markup
- Added locaiton for presentation
- Updated object.type physical object (incorrect as it is ORA value) to artefact OR c-device-product
22/11/19: Updated value-map name="licences">
21/11/19: Remove crosswalk for author-url
20/11/19:
- Updated name type = "institutional _identifier" to type = "sso" and to map from SE username rather than SE prop ID
- changed default Hyrax model value header to Hyrax-Work-Model (TW)
- Updated ORA admin email
- Updated grant (object)
- Add licence value-map (Git issue #131)
- updated journal article subtype mapping (Git issue #134)
19/11/19: 
- Update ora-work-type-mappings/hyrax-work-type-mappings to map to "Unknown" for unrecognised types
- updated conference paper or performance related item
- Author URL
- correct issue with last commit (ln 186 contributor url)
18/11/19: 
- moved recordInfo into administrative-metadata field map.
- Updated apc
- Updated user affiliations for dept, subdept
- Updated typo in Addendum
- Updated grant from related object
15/11/19: Updated Ephemera in ora-work-type-mappings
13/11/19: Updated case in ora-subtype-work-mappings-from-subtype
11/11/19: Updated related grants from funding-acknowledgements
08/11/19:
- Updated journal article subtypes (2)
- Updated journal article subtypes
- Updated confidential report field-map (2)

- Updated confidential report field-map
07/11/19:
- Added in sub_type_of_work crosswalk
- Corrected existing value-map for ora-subtype-work-mappings-from-type
- Added dataset to ora-work-type-mappings
- corrected recordInfoNote type="confidential_report"
07/11/19: Added in requested embargo and embargo comments (requested-embargo.comment, requested-embargo.display-name)
06/11/19: 
- Updated Funding acnkowledgements
- added mapping to Universal Test Object
04/11/19: Updated publication-status value map as per Git issue #112 https://github.com/tomwrobel/ora_data_model/issues/112
24/10/19: Updated publication-status value map
23/10/19:Updated grant relationships funder information
22/10/19:
- updated citation_publication_date (including conditionals for available online-publication-date)
- added working paper version to file metadata dcterms:hasVersion
21/19/19: added software/code version to ora_dataset:dataset/dc:version
16/10/19
- Updated SE confidential field to ORA type and subtype and confidential_report field.
10/10/19
- Updated  <xwalk:value-map name="ora-subtype-work-mappings-from-subtype">14-10-2019
- Updated publisher name to contributor type manufacturer
- Updated location deposit for dataset ->digital_storage_location/physical_storage_location
9/10/19  
- Moved pagination to common-fields-fieldmap
- Moved default-map to be included in journal-markup and book-markup rather than other way around
- Renamed default-map to common-fields-map
- Added device-product production_date conditional to place of publication






-->
 <xwalk:parameters>
    <!-- Instructs the crosswalk framework to use the 1st when dealing with a month-precision date,
    and January when dealing with a year-precision date -->
    <xwalk:parameter name="use-default-values-for-missing-date-components" value="true"/>
  </xwalk:parameters>
  <!-- Defines how metadata is generated for files that have been uploaded.  
  This map is executed for each file and uploaded via Sword one-by-one -->
  <xwalk:file-metadata-map>
    
    <xwalk:field-mapping to="ora:repository_file">
       <xwalk:if>
        <xwalk:condition argument-field="object.type" operator="equals">c-report</xwalk:condition>
        <xwalk:result>
      <xwalk:field-source from="file.name" subfield="dc:title"/>
      <xwalk:field-source from="file.version" subfield="rioxxterms:version" value-map="file-versions"/>
      <xwalk:field-source from="version" subfield="dcterms:hasVersion"/>
      <xwalk:field-source from="requested-embargo.comment" subfield="ora:embargoComment"/>
      <xwalk:field-source from="requested-embargo.display-name" subfield="ora:embargoPeriod"/> 
    </xwalk:result>
    <xwalk:else>
        <xwalk:result>
      <xwalk:field-source from="file.name" subfield="dc:title"/>
      <xwalk:field-source from="file.version" subfield="rioxxterms:version" value-map="file-versions"/>
      <xwalk:field-source from="requested-embargo.comment" subfield="ora:embargoComment"/>
      <xwalk:field-source from="requested-embargo.display-name" subfield="ora:embargoPeriod"/>
  </xwalk:result>
</xwalk:else>
</xwalk:if>
    </xwalk:field-mapping>
  </xwalk:file-metadata-map>
  <!-- Item-level metadata maps -->
  <xwalk:field-maps>
    <!-- Specially named field map "http-headers". This is run and the results are provided to
    Elements in order to add the key-value pairs as HTTP headers during the item deposit -->
    <xwalk:field-map name="http-headers">
      <!-- To be uncommented when the On-Behalf-Of user is available -->
      <xwalk:field-mapping to="On-Behalf-Of">
        <xwalk:field-source value="ora.system@bodleian.ox.ac.uk"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="Hyrax-Work-Model">
        <xwalk:field-source from="object.type" value-map="hyrax-work-type-mappings"/>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <!-- Specially named field map "administrative-metadata". This is run and the results are placed in the administrative 
    metadata MODS section -->
    <xwalk:field-map name="administrative-metadata">
      <xwalk:field-mapping to="extension">
        <xwalk:field-source subfield="ora_admin:admin">
          <xwalk:field-source subfield="ora_admin:rights_third_party_copyright_material" value="test"/>
          <xwalk:field-source subfield="ora_admin:rights_third_party_copyright_permission_received" value="unknown"/>
        </xwalk:field-source>
      </xwalk:field-mapping>

      <xwalk:field-mapping to="recordInfo">
        <xwalk:field-source subfield="recordContentSource" value="Symplectic Elements"/>
        <xwalk:field-source subfield="recordInfoNote">
        <xwalk:field-source subfield="@type" value="confidential_report"/>
        <xwalk:field-source from="confidential"/>
      </xwalk:field-source>
      </xwalk:field-mapping>

      <xwalk:field-mapping to="extension">
  <xwalk:field-source subfield="ora_open_access_admin:ref_admin">
        <xwalk:field-source subfield = "ora_open_access_admin:apc_admin_apc_requested" from="c-apc" value-map="apc"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>




    <xwalk:field-map name="common-fields-map">
      <xwalk:include-field-map name="contributors"/>
      <xwalk:include-field-map name="identifiers"/>
      <xwalk:include-field-map name="access-conditions"/>

      <!--added form journal markup. Check does this or joural markup need to be amended.-->

      <xwalk:field-mapping to="relatedItem">
        <xwalk:field-source subfield="@type" value="host"/>
        <xwalk:field-source subfield="titleInfo">
          <xwalk:field-source from="journal" subfield="title"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="part">
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="article"/>
            <xwalk:field-source from="number" subfield="number" value-map="parse-article-number"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="issue"/>
            <xwalk:field-source from="issue" subfield="number"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="extent">
            <xwalk:field-source subfield="@unit" value="pages"/>
            <xwalk:field-source format="pagination:start-end" from="pagination" subfield="list"/>
          </xwalk:field-source>
                  <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="volume"/>
            <xwalk:field-source from="volume" subfield="number"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <!--Removed, not in mapping doc
        <xwalk:field-source subfield="location">
          <xwalk:field-source from="publisher-url" subfield="url"/>
        </xwalk:field-source>-->
        <xwalk:field-source subfield="physicalDescription">
          <xwalk:field-source subfield="form">
            <xwalk:field-source subfield="@type" value="status"/>
            <xwalk:field-source from="publication-status" value-map="publication-status"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="form">
            <xwalk:field-source subfield="@type" value="peer_reviewed"/>
            <xwalk:field-source value="true"/>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>


      <!-- end of added from journal markup. -->

      <xwalk:field-mapping to="relatedItem">
        <xwalk:field-source subfield="@type" value="series"/>
        <xwalk:field-source subfield="titleInfo">
          <xwalk:field-source from="series" subfield="title"/>
        </xwalk:field-source>
        </xwalk:field-mapping>


      <xwalk:field-mapping to="physicalDescription">
        <xwalk:field-source subfield="form">
          <xwalk:field-source subfield="@type" value="physical_form"/>
          <xwalk:field-source from="medium"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="relatedItem">
        <xwalk:field-source subfield="@type" value="host"/>
        <xwalk:field-source subfield="physicalDescription"/>
        <xwalk:field-source subfield="form"/>
        <xwalk:field-source subfield="@type" value="status"/>
        <xwalk:field-source from="publication-status" value-map="publication-status"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:choose>
          <xwalk:when>
            <xwalk:condition argument-field="object.type" operator="equals">c-report</xwalk:condition>
            <xwalk:result>
              <xwalk:field-source subfield="@type" value="paper_number"/>
              <xwalk:field-source from="number"/>
            </xwalk:result>
          </xwalk:when>
          <xwalk:when>
            <xwalk:condition argument-field="object.type" operator="equals">patent</xwalk:condition>
            <xwalk:result>
              <xwalk:field-source subfield="@type" value="patent_application_number"/>
              <xwalk:field-source from="number"/>
            </xwalk:result>
          </xwalk:when>
        </xwalk:choose>
      </xwalk:field-mapping>

   <!-- Big chunk of related item mapping which needs to be repeated in full for three types-->

      <xwalk:field-mapping to="relatedItem">
        <xwalk:choose>
          <xwalk:when>
          <xwalk:condition operator="or">
            <xwalk:condition argument-field="object.type" operator="equals">conference</xwalk:condition>
            <xwalk:condition argument-field="object.type" operator="equals">performance</xwalk:condition>
            <xwalk:condition argument-field="object.type" operator="equals">presentation</xwalk:condition>
          </xwalk:condition>
          <xwalk:result>

            <xwalk:field-source subfield="@otherType" value="event"/>

            <xwalk:field-source subfield="titleInfo">
              <xwalk:field-source from="name-of-conference" subfield="title"/>
            </xwalk:field-source>

          <xwalk:field-source subfield="location">
                <xwalk:field-source from="location" subfield="physicalLocation"/>
              </xwalk:field-source>
              <xwalk:field-source subfield="originInfo">
                <xwalk:field-source subfield="dateOther">
                  <xwalk:field-source subfield="@point" value="start"/>
                  <xwalk:field-source subfield="@type" value="event_date"/>
                  <xwalk:field-source from="start-date"/>
                </xwalk:field-source>
                <xwalk:field-source subfield="dateOther">
                  <xwalk:field-source subfield="@point" value="end"/>
                  <xwalk:field-source subfield="@type" value="event_date"/>
                  <xwalk:field-source from="finish-date"/>
                </xwalk:field-source>
              </xwalk:field-source>
          </xwalk:result>
        </xwalk:when>
         <xwalk:when>
            <xwalk:condition argument-field="object.type" operator="equals">patent</xwalk:condition>
            <xwalk:result>
              <xwalk:field-source subfield="@otherType" value="event"/>
              <xwalk:field-source subfield="originInfo">
                 <xwalk:field-source subfield="dateOther">
                  <xwalk:field-source subfield="@point" value="end"/>
                  <xwalk:field-source subfield="@type" value="event_date"/>
                  <xwalk:field-source from="finish-date"/>
                </xwalk:field-source>
              </xwalk:field-source>
            </xwalk:result>
          </xwalk:when>
           <xwalk:otherwise>
            <xwalk:result>
              <xwalk:field-source subfield="@otherType" value="event"/>
              <xwalk:field-source subfield="originInfo">
                <xwalk:field-source subfield="dateOther">
                  <xwalk:field-source subfield="@point" value="start"/>
                  <xwalk:field-source subfield="@type" value="event_date"/>
                  <xwalk:field-source from="start-date"/>
                </xwalk:field-source>
                <xwalk:field-source subfield="dateOther">
                  <xwalk:field-source subfield="@point" value="end"/>
                  <xwalk:field-source subfield="@type" value="event_date"/>
                  <xwalk:field-source from="finish-date"/>
                </xwalk:field-source>
              </xwalk:field-source>
            </xwalk:result>
          </xwalk:otherwise>
        </xwalk:choose>
      </xwalk:field-mapping>



      <xwalk:field-mapping to="accessCondition">
        <xwalk:field-source subfield="@type" value="license"/>
        <xwalk:field-source from="publisher-licence" value-map="licences"/>
      </xwalk:field-mapping>
     

        
         
      <xwalk:field-mapping to="location">
        <xwalk:if>
          <!-- TODO: Check item type -->
          <xwalk:condition operator="or">
          <xwalk:condition argument-field="object.type" operator="equals">c-device-product</xwalk:condition>
          <xwalk:condition argument-field="object.type" operator="equals">artefact</xwalk:condition>
        </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source from="location" subfield="physicalLocation"/>
          </xwalk:result>
        </xwalk:if>
       </xwalk:field-mapping>
      <!--DO WE NEED THIS IN ADDIOTN TO JA PLACE OF PUB TO CITATION xwalk:field-mapping to="location"><xwalk:if>-->
      <!-- TODO: Check item type -->


      <xwalk:field-mapping to="genre">
            <xwalk:field-source subfield="@type" value="type_of_work"/>
          <xwalk:field-source from="object.type" value-map="ora-work-type-mappings"/>
          </xwalk:field-mapping>

      <xwalk:field-mapping to="genre">    
            <xwalk:field-source subfield="@type" value="sub_type_of_work"/>
          <xwalk:field-source from="object.type" value-map="ora-subtype-work-mappings-from-type"/>
      </xwalk:field-mapping>




      <xwalk:field-mapping to="titleInfo">
        <xwalk:field-source from="title" subfield="title"/>
        <xwalk:field-source from="field-47" subfield="subTitle"/>
      </xwalk:field-mapping>
     
      <xwalk:field-mapping to="language">
        <xwalk:field-source subfield="languageTerm">
          <xwalk:field-source subfield="@authority" value="iso639-2b"/>
          <xwalk:field-source subfield="@type" value="text"/>
          <xwalk:field-source from="language"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="abstract">
        <xwalk:if>
          <xwalk:condition operator="or">
            <xwalk:condition argument-field="object.type" operator="equals">patent</xwalk:condition>
            <!-- TODO: Check these object types. Response - seem OK DS) -->
            <xwalk:condition argument-field="object.type" operator="equals">c-device-product</xwalk:condition>
            <xwalk:condition argument-field="object.type" operator="equals">artefact</xwalk:condition>
            <xwalk:condition argument-field="object.type" operator="equals">ephemera</xwalk:condition>
          </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source subfield="@type" value="summary_documentation"/>
          </xwalk:result>
        </xwalk:if>
        <xwalk:field-source from="abstract"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="note">
        <xwalk:field-source subfield="@displayLabel" value="additional_information"/>
        <xwalk:field-source concatenate-with-separator=";">
          <xwalk:field-source from="notes"/>
          <xwalk:field-source data-part="funding-acknowledgements:acknowledgement-text" from="funding-acknowledgements"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!-- TODO: Event -->
      <!-- Identifier mappings imported -->
      

      <xwalk:field-mapping to="originInfo">
        <xwalk:if>
          <!--To take dateIssued from online-publication-date if it has a value. Have to repeat all other fields in condition result - I'm not sure there is a better way of doing it. -->
           <xwalk:condition argument-field="/api:push-object/api:object/api:view/api:field[@name='online-publication-date']/api:date" operator="has-value" select-using="xpath"/>
           <xwalk:result>
        <xwalk:field-source subfield="dateOther">
          <xwalk:field-source subfield="@type" value="date_of_acceptance"/>
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source from="acceptance-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="dateIssued">
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source format="date:YYYY-MM-DD" from="online-publication-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="copyrightDate">
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source data-part="date:year" from="publication-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source from="location"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <!--        Removed, not in mapping doc
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="code"/>
            <xwalk:field-source from="publisher-url"/>
          </xwalk:field-source>
        </xwalk:field-source>-->
      </xwalk:result>
      <xwalk:else>
        <xwalk:result>
          <xwalk:field-source subfield="dateOther">
          <xwalk:field-source subfield="@type" value="date_of_acceptance"/>
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source from="acceptance-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="dateIssued">
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source format="date:YYYY-MM-DD" from="publication-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="copyrightDate">
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source data-part="date:year" from="publication-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source from="place-of-publication"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <!--        Removed, not in mapping doc
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="code"/>
            <xwalk:field-source from="publisher-url"/>
          </xwalk:field-source>
        </xwalk:field-source>-->
        </xwalk:result>
      </xwalk:else>
    </xwalk:if>
      </xwalk:field-mapping>

      <!-- RELATED PUBLICATIONS -->
      <xwalk:field-mapping to="relatedItem">
        <xwalk:field-source from="object.relationships" value-map="publication-relationships">
          <xwalk:field-source data-part="relationship:other-object">
            <xwalk:field-source subfield="@otherType" value="related_item"/>
            <xwalk:field-source subfield="titleInfo">
              <xwalk:field-source from="title" subfield="title"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="location">
              <xwalk:field-source from="doi" prefix="http://dx.doi.org/" subfield="url"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="note">
              <xwalk:field-source subfield="@displayLabel" value="related_item_citation_text">
                <xwalk:field-source from="journal"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!-- RELATED GRANTS -->
      <xwalk:field-mapping to="name">
        <xwalk:field-source from="object.relationships" value-map="grant-relationships">
          <xwalk:field-source data-part="relationship:other-object">
            <xwalk:field-source subfield="@type" value="corporate" />
            <xwalk:field-source subfield="displayForm" from="funder-name" />
            <xwalk:field-source subfield="role">
              <xwalk:field-source subfield="roleTerm">
                <xwalk:field-source subfield="@type" value="text" />
                <xwalk:field-source value="Funder" />
              </xwalk:field-source>
            </xwalk:field-source>
            <!--<xwalk:field-source subfield="nameIdentifier">
              <xwalk:field-source subfield="@type" value="funder_identifier" />
              <xwalk:field-source from="funder-reference" />
            </xwalk:field-source>-->
            <xwalk:field-source subfield="affiliation">
              <!--<xwalk:field-source subfield="ora_admin:funding_programme" from="programme" />-->
<xwalk:field-source subfield="ora_admin:funding">
                <xwalk:field-source subfield="ora_admin:funder_grant">
              <xwalk:field-source subfield="ora_admin:grant_identifier" from="funder-reference" />
</xwalk:field-source>
</xwalk:field-source>
            </xwalk:field-source>




          </xwalk:field-source>
        </xwalk:field-source>
        <!-- TODO: Futher grant field mappings. -->
      </xwalk:field-mapping>


      <!-- Related grants from the funding-acknowlegdements field -->
<xwalk:field-mapping to="name">
    <xwalk:field-source subfield="@type" value="corporate"/>
    <xwalk:field-source subfield="displayForm">
        <xwalk:field-source from="funding-acknowledgements" data-part="funding-acknowledgements:grant">
            <xwalk:field-source data-part="funding-acknowledgements-grant:org"/>
        </xwalk:field-source>
    </xwalk:field-source>

    <xwalk:field-source subfield="role">
        <xwalk:field-source subfield="roleTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source value="Funder"/>
        </xwalk:field-source>
    </xwalk:field-source>

    <xwalk:field-source subfield="affiliation">
        <xwalk:field-source subfield="ora_admin:funding">
          <xwalk:field-source subfield="ora_admin:funder_grant">
            <xwalk:field-source subfield="ora_admin:grant_identifier">
            <xwalk:field-source from="funding-acknowledgements" data-part="funding-acknowledgements-grant:id"/>
        </xwalk:field-source>
        </xwalk:field-source>
        </xwalk:field-source>
    </xwalk:field-source>

</xwalk:field-mapping>

      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="corporate"/>
        <xwalk:field-source from="commissioning-body" subfield="displayForm"/>
        <xwalk:field-source subfield="role">
          <xwalk:field-source subfield="roleTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source value="Commissioning body"/>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!-- Contributors imported -->
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="corporate"/>
        <xwalk:field-source from="publisher" subfield="displayForm"/>
        <xwalk:field-source subfield="role">
          <xwalk:field-source subfield="roleTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source value="Publisher"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <xwalk:field-source subfield="nameIdentifier">
          <xwalk:field-source subfield="@type" value="website"/>
          <xwalk:field-source from="publisher-url"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!--commenting to try keyword field rather than object level
      <xwalk:field-mapping to="subject"><xwalk:field-source subfield="genre" from="object.keywords" /></xwalk:field-mapping>-->
      <xwalk:field-mapping to="subject">
        <xwalk:field-source from="keywords" subfield="genre"/>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <!-- Author contributor metadata -->
    <xwalk:field-map name="contributors">
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="personal"/>
        <xwalk:field-source from="authors">
          <xwalk:field-source format="person:firstnames-lastname" subfield="displayForm"/>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="given"/>
            <xwalk:field-source data-part="person:firstnames"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="family"/>
            <xwalk:field-source data-part="person:lastname"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="alternativeName">
            <xwalk:field-source subfield="@altType" value="initials"/>
            <xwalk:field-source data-part="person:initials" subfield="namePart"/>
          </xwalk:field-source>

<!--Don't crosswalk. There is no SE equivalent of personal author website

<xwalk:field-source subfield="nameIdentifier">
          <xwalk:field-source subfield="@type" value="website"/>
          <xwalk:field-source from="author-url"/>
        </xwalk:field-source> -->


          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source subfield="@type" value="email_address"/>
            <!-- There are a few email address sources we could use, but we only want to use one. -->
            <!-- So, build a list, but state that the output is not a list -->
            <xwalk:field-source is-list="false">
              <xwalk:field-source data-part="person:resolved-user">
                <xwalk:field-source from="user.email-address"/>
              </xwalk:field-source>
              <xwalk:field-source data-part="person:email-address"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- First map stuff from the resolved Elements user -->
          <xwalk:field-source data-part="person:resolved-user" subfield="nameIdentifier">
            <xwalk:field-source from="user.identifiers" value-map="remove-irrelevant-identifiers">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
            <xwalk:field-source>
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="user.username"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- Then map stuff from the biliographic metadata. This may result in duplication of some identifiers -->
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source data-part="person:identifier">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="affiliation">
            <xwalk:field-source data-part="person:resolved-user" subfield="ora:affiliation">
              <xwalk:field-source subfield = "ora:affiliationComponent">
              <!-- TODO: field:contributors__institution_identifier -->
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="division"/>
                <xwalk:field-source from="user.generic01"/>
              </xwalk:field-source>
              </xwalk:field-source>
               <xwalk:field-source subfield = "ora:affiliationComponent">
                <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="department"/>
                <xwalk:field-source from="user.primary-group-descriptor"/>
                </xwalk:field-source>
              </xwalk:field-source>
               <xwalk:field-source subfield = "ora:affiliationComponent">
                <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="sub_department"/>
                <xwalk:field-source from="user.generic07"/>
                </xwalk:field-source>
              </xwalk:field-source>

               <xwalk:field-source subfield = "ora:affiliationComponent">
                <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="oxford_college"/>
                <xwalk:field-source from="user.generic03"/>
                </xwalk:field-source>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="role">
            <xwalk:field-source subfield="mods:extension">
              <!-- 'temp:value1' is used temporarily as the person index -->
              <xwalk:field-source data-part="temp:value1" subfield="ora:role_order"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source value="Author"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source data-part="person:resolved-user" subfield="role">
            <xwalk:field-source from="user.depositor-type" subfield="mods:extension" value-map="is-deposit-related">
              <xwalk:field-source subfield="ora:role_order" value="1"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source from="user.depositor-type" value-map="depositor-type-to-role"/>
            </xwalk:field-source>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!--DS adds editor contributor metadata-->
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="personal"/>
        <xwalk:field-source from="editors">
          <xwalk:field-source format="person:firstnames-lastname" subfield="displayForm"/>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="given"/>
            <xwalk:field-source data-part="person:firstnames"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="family"/>
            <xwalk:field-source data-part="person:lastname"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="alternativeName">
            <xwalk:field-source subfield="@altType" value="initials"/>
            <xwalk:field-source data-part="person:initials" subfield="namePart"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source subfield="@type" value="email_address"/>
            <!-- There are a few email address sources we could use, but we only want to use one. -->
            <!-- So, build a list, but state that the output is not a list -->
            <xwalk:field-source is-list="false">
              <xwalk:field-source data-part="person:resolved-user">
                <xwalk:field-source from="user.email-address"/>
              </xwalk:field-source>
              <xwalk:field-source data-part="person:email-address"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- First map stuff from the resolved Elements user -->
          <xwalk:field-source data-part="person:resolved-user" subfield="nameIdentifier">
            <xwalk:field-source from="user.identifiers" value-map="remove-irrelevant-identifiers">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
            <xwalk:field-source>
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="user.username"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- Then map stuff from the biliographic metadata. This may result in duplication of some identifiers -->
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source data-part="person:identifier">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="affiliation">
            <xwalk:field-source data-part="person:resolved-user" subfield="ora:affiliation">
              <!-- TODO: field:contributors__institution_identifier -->
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="division"/>
                <xwalk:field-source from="user.generic01"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="department"/>
                <xwalk:field-source from="user.primary-group-descriptor"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="subdepartment"/>
                <xwalk:field-source from="user.department"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="oxford_college"/>
                <xwalk:field-source from="user.generic03"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="role">
            <xwalk:field-source subfield="mods:extension">
              <!-- 'temp:value1' is used temporarily as the person index -->
              <xwalk:field-source data-part="temp:value1" subfield="ora:role_order"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source value="Editor"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source data-part="person:resolved-user" subfield="role">
            <xwalk:field-source from="user.depositor-type" subfield="mods:extension" value-map="is-deposit-related">
              <xwalk:field-source subfield="ora:role_order" value="1"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source from="user.depositor-type" value-map="depositor-type-to-role"/>
            </xwalk:field-source>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="personal"/>
        <xwalk:field-source from="c-translator">
          <xwalk:field-source format="person:firstnames-lastname" subfield="displayForm"/>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="given"/>
            <xwalk:field-source data-part="person:firstnames"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="family"/>
            <xwalk:field-source data-part="person:lastname"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="alternativeName">
            <xwalk:field-source subfield="@altType" value="initials"/>
            <xwalk:field-source data-part="person:initials" subfield="namePart"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source subfield="@type" value="email_address"/>
            <!-- There are a few email address sources we could use, but we only want to use one. -->
            <!-- So, build a list, but state that the output is not a list -->
            <xwalk:field-source is-list="false">
              <xwalk:field-source data-part="person:resolved-user">
                <xwalk:field-source from="user.email-address"/>
              </xwalk:field-source>
              <xwalk:field-source data-part="person:email-address"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- First map stuff from the resolved Elements user -->
          <xwalk:field-source data-part="person:resolved-user" subfield="nameIdentifier">
            <xwalk:field-source from="user.identifiers" value-map="remove-irrelevant-identifiers">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
            <xwalk:field-source>
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="user.username"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- Then map stuff from the biliographic metadata. This may result in duplication of some identifiers -->
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source data-part="person:identifier">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="affiliation">
            <xwalk:field-source data-part="person:resolved-user" subfield="ora:affiliation">
              <!-- TODO: field:contributors__institution_identifier -->
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="division"/>
                <xwalk:field-source from="user.generic01"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="department"/>
                <xwalk:field-source from="user.primary-group-descriptor"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="subdepartment"/>
                <xwalk:field-source from="user.department"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="oxford_college"/>
                <xwalk:field-source from="user.generic03"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="role">
            <xwalk:field-source subfield="mods:extension">
              <!-- 'temp:value1' is used temporarily as the person index -->
              <xwalk:field-source data-part="temp:value1" subfield="ora:role_order"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source value="Translator"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source data-part="person:resolved-user" subfield="role">
            <xwalk:field-source from="user.depositor-type" subfield="mods:extension" value-map="is-deposit-related">
              <xwalk:field-source subfield="ora:role_order" value="1"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source from="user.depositor-type" value-map="depositor-type-to-role"/>
            </xwalk:field-source>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>

      <!--DS adds associated authors contributor metadata-->
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="personal"/>
        <xwalk:field-source from="associated-authors">
          <xwalk:field-source format="person:firstnames-lastname" subfield="displayForm"/>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="given"/>
            <xwalk:field-source data-part="person:firstnames"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="namePart">
            <xwalk:field-source subfield="@type" value="family"/>
            <xwalk:field-source data-part="person:lastname"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="alternativeName">
            <xwalk:field-source subfield="@altType" value="initials"/>
            <xwalk:field-source data-part="person:initials" subfield="namePart"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source subfield="@type" value="email_address"/>
            <!-- There are a few email address sources we could use, but we only want to use one. -->
            <!-- So, build a list, but state that the output is not a list -->
            <xwalk:field-source is-list="false">
              <xwalk:field-source data-part="person:resolved-user">
                <xwalk:field-source from="user.email-address"/>
              </xwalk:field-source>
              <xwalk:field-source data-part="person:email-address"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- First map stuff from the resolved Elements user -->
          <xwalk:field-source data-part="person:resolved-user" subfield="nameIdentifier">
            <xwalk:field-source from="user.identifiers" value-map="remove-irrelevant-identifiers">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
            <xwalk:field-source>
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="user.username"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <!-- Then map stuff from the biliographic metadata. This may result in duplication of some identifiers -->
          <xwalk:field-source subfield="nameIdentifier">
            <xwalk:field-source data-part="person:identifier">
              <xwalk:field-source data-part="identifier:scheme" subfield="@type" value-map="contributor-identifier-scheme"/>
              <xwalk:field-source data-part="identifier:value"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="affiliation">
            <xwalk:field-source data-part="person:resolved-user" subfield="ora:affiliation">
              <!-- TODO: field:contributors__institution_identifier -->
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="division"/>
                <xwalk:field-source from="user.generic01"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="department"/>
                <xwalk:field-source from="user.primary-group-descriptor"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="subdepartment"/>
                <xwalk:field-source from="user.department"/>
              </xwalk:field-source>
              <xwalk:field-source>
                <xwalk:field-source subfield="@type" value="oxford_college"/>
                <xwalk:field-source from="user.generic03"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source subfield="role">
            <xwalk:field-source subfield="mods:extension">
              <!-- 'temp:value1' is used temporarily as the person index -->
              <xwalk:field-source data-part="temp:value1" subfield="ora:role_order"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source value="Contributor"/>
            </xwalk:field-source>
          </xwalk:field-source>
          <xwalk:field-source data-part="person:resolved-user" subfield="role">
            <xwalk:field-source from="user.depositor-type" subfield="mods:extension" value-map="is-deposit-related">
              <xwalk:field-source subfield="ora:role_order" value="1"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="roleTerm">
              <xwalk:field-source subfield="@type" value="text"/>
              <xwalk:field-source from="user.depositor-type" value-map="depositor-type-to-role"/>
            </xwalk:field-source>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <!-- End of DS add associated authors contributor metadata-->
      <!-- We output the depositor details, only if they were not included in the existing author or editor list details -->
      <xwalk:field-mapping to="name">
        <xwalk:if>
          <xwalk:condition operator="not">
            <xwalk:condition argument-field="string(/api:push-object/api:object/api:view/api:field[@name = 'authors' or @name = 'editors']/api:people/api:person/api:links/api:link[@type = 'elements/user' and @id = string(/api:push-object/api:push-supplementary-info/api:deposit-info/api:depositor/@id)]/@id)" operator="has-value" select-using="xpath"/>
          </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source subfield="@type" value="personal"/>
            <xwalk:field-source from="depositor.full-name" subfield="displayForm"/>
            <xwalk:field-source subfield="namePart">
              <xwalk:field-source subfield="@type" value="given"/>
              <xwalk:field-source from="depositor.first-name"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="namePart">
              <xwalk:field-source subfield="@type" value="family"/>
              <xwalk:field-source from="depositor.last-name"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="alternativeName">
              <xwalk:field-source subfield="@altType" value="initials"/>
              <xwalk:field-source from="depositor.initials" subfield="namePart"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="nameIdentifier">
              <xwalk:field-source subfield="@type" value="email_address"/>
              <xwalk:field-source from="depositor.email-address"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="nameIdentifier">
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="depositor.username"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="role">
              <xwalk:field-source subfield="mods:extension">
                <xwalk:field-source subfield="ora:role_order" value="1"/>
              </xwalk:field-source>
              <xwalk:field-source subfield="roleTerm">
                <xwalk:field-source subfield="@type" value="text"/>
                <xwalk:field-source from="depositor.is-impersonating" value-map="is-impersonating-to-role"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:result>
        </xwalk:if>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="name">
        <xwalk:if>
          <xwalk:condition operator="and">
            <xwalk:condition argument-field="/api:push-object/api:push-supplementary-info/api:deposit-info/api:impersonated-depositor" operator="has-value" select-using="xpath"/>
            <xwalk:condition operator="not">
              <xwalk:condition argument-field="string(/api:push-object/api:object/api:view/api:field[@name = 'authors' or @name = 'editors']/api:people/api:person/api:links/api:link[@type = 'elements/user' and @id = string(/api:push-object/api:push-supplementary-info/api:deposit-info/api:impersonated-depositor/@id)]/@id)" operator="has-value" select-using="xpath"/>
            </xwalk:condition>
          </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source subfield="@type" value="personal"/>
            <xwalk:field-source from="impersonated-depositor.full-name" subfield="displayForm"/>
            <xwalk:field-source subfield="namePart">
              <xwalk:field-source subfield="@type" value="given"/>
              <xwalk:field-source from="impersonated-depositor.first-name"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="namePart">
              <xwalk:field-source subfield="@type" value="family"/>
              <xwalk:field-source from="impersonated-depositor.last-name"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="alternativeName">
              <xwalk:field-source subfield="@altType" value="initials"/>
              <xwalk:field-source from="impersonated-depositor.initials" subfield="namePart"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="nameIdentifier">
              <xwalk:field-source subfield="@type" value="email_address"/>
              <xwalk:field-source from="impersonated-depositor.email-address"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="nameIdentifier">
              <xwalk:field-source subfield="@type" value="sso"/>
              <xwalk:field-source from="impersonated-depositor.username"/>
            </xwalk:field-source>
            <xwalk:field-source subfield="role">
              <xwalk:field-source subfield="mods:extension">
                <xwalk:field-source subfield="ora:role_order" value="1"/>
              </xwalk:field-source>
              <xwalk:field-source subfield="roleTerm">
                <xwalk:field-source subfield="@type" value="text"/>
                <xwalk:field-source from="depositor.is-impersonating" value-map="is-impersonating-to-role"/>
              </xwalk:field-source>
            </xwalk:field-source>
          </xwalk:result>
        </xwalk:if>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <!-- Various persistent item-level identifiers (DOI, ISSN, etc) -->
    <xwalk:field-map name="identifiers">
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="doi"/>
        <xwalk:field-source from="doi"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="issn"/>
        <xwalk:field-source from="issn"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="eissn"/>
        <xwalk:field-source from="eissn"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="pii"/>
        <xwalk:field-source from="pii"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="pubs_id"/>
        <xwalk:field-source from="object.id"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="tinypid"/>
        <xwalk:field-source from="object.id" prefix="pubs:"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source from="external-identifiers">
          <xwalk:field-source subfield="@type">
            <xwalk:field-source data-part="identifier:scheme" value-map="identifier-type"/>
          </xwalk:field-source>
          <xwalk:field-source data-part="identifier:value"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="isbn"/>
        <xwalk:field-source from="isbn-10"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="identifier">
        <xwalk:field-source subfield="@type" value="isbn13"/>
        <xwalk:field-source from="isbn-13"/>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <!-- Journal article metadata (pagination, volume, etc) -->
    <xwalk:field-map name="journal-markup">
      <xwalk:include-field-map name="common-fields-map">
      <xwalk:exclude-field-mapping to="genre" />
    </xwalk:include-field-map>



<!-- Set is-list to false to force the first item to be selected -->
<xwalk:field-mapping to="genre">
        <xwalk:field-source subfield="@type" value="type_of_work"/>
          <xwalk:field-source from="object.type" value-map="ora-work-type-mappings"/>
        </xwalk:field-mapping>

    <xwalk:field-mapping is-list="false" to="genre">
          <xwalk:field-source subfield="@type" value="sub_type_of_work"/>
            <xwalk:field-source from="types" value-map="ora-subtype-work-mappings-from-subtype"/>
        </xwalk:field-mapping>


      <!-- Set is-list to false to force the first item to be selected -->

    </xwalk:field-map>
    <xwalk:field-map name="book-markup">
      <xwalk:include-field-map name="common-fields-map">
      <xwalk:exclude-field-mapping to="relatedItem" />
    </xwalk:include-field-map>
      <xwalk:field-mapping to="relatedItem">
        <xwalk:field-source subfield="@type" value="host"/>
        <xwalk:field-source subfield="titleInfo">
          <xwalk:field-source from="parent-title" subfield="title"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="part">
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="chapter_number"/>
            <xwalk:field-source from="number" subfield="number"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="edition"/>
            <xwalk:field-source from="edition" subfield="number"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@unit" value="pages"/>
            <xwalk:field-source format="pagination:start-end" from="pagination" subfield="list"/>
          </xwalk:field-source>
          <xwalk:field-source subfield="detail">
            <xwalk:field-source subfield="@type" value="volume"/>
            <xwalk:field-source from="volume" subfield="number"/>
          </xwalk:field-source>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <xwalk:field-map name="device-product-markup">
      <xwalk:include-field-map name="common-fields-map"/>
      <xwalk:field-mapping to="originInfo">
        <xwalk:field-source subfield="dateOther">
          <xwalk:field-source subfield="@type" value="date_of_acceptance"/>
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source from="acceptance-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="copyrightDate">
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source data-part="date:year" from="publication-date"/>
        </xwalk:field-source>
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source from="place-of-publication"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <!--Removed not in mapping doc
        <xwalk:field-source subfield="place">
          <xwalk:field-source subfield="placeTerm">
            <xwalk:field-source subfield="@type" value="code"/>
            <xwalk:field-source from="publisher-url"/>
          </xwalk:field-source>
        </xwalk:field-source>-->
        <xwalk:field-source subfield="dateOther">
          <xwalk:field-source subfield="@type" value="production_date"/>
          <xwalk:field-source subfield="@encoding" value="iso8601"/>
          <xwalk:field-source from="publication-date"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="name">
        <xwalk:field-source subfield="@type" value="corporate"/>
        <xwalk:field-source from="publisher" subfield="displayForm"/>
        <xwalk:field-source subfield="role">
          <xwalk:field-source subfield="roleTerm">
            <xwalk:field-source subfield="@type" value="text"/>
            <xwalk:field-source value="Manufacturer"/>
          </xwalk:field-source>
        </xwalk:field-source>
        <xwalk:field-source subfield="nameIdentifier">
          <xwalk:field-source subfield="@type" value="website"/>
          <xwalk:field-source from="publisher-url"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <xwalk:field-map name="patent-markup">
      <xwalk:include-field-map name="common-fields-map"/>
      <xwalk:field-mapping to="extension">
        <xwalk:field-source subfield="ora_patent:patent">
          <xwalk:field-source from="patent-number" subfield="ora_patent:number"/>
          <xwalk:field-source from="filed-date" subfield="ora_patent:filed_date"/>
          <xwalk:field-source from="patent-status" subfield="ora_patent:patent_status"/>
          <xwalk:field-source from="location" subfield="ora_patent:territory"/>
          <xwalk:field-source from="start-date" subfield="ora_patent:awarded_date"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>
    
    <xwalk:field-map name="dataset-markup">
      <xwalk:include-field-map name="common-fields-map"/>
      <xwalk:field-mapping to="extension">
        <xwalk:if>
          <!-- TODO: Check item type -->
          <xwalk:condition operator="and">
            <xwalk:condition argument-field="object.type" operator="equals">dataset</xwalk:condition>
            <xwalk:condition argument-field="/api:push-object/api:object/api:view/api:field[@name='doi']/api:text" operator="has-value" select-using="xpath"/>
          </xwalk:condition>
          <xwalk:result>
            <xwalk:field-source subfield="ora_dataset:dataset">
            <xwalk:field-source from="location" subfield="ora_dataset:digital_storage_location"/>
          </xwalk:field-source>
          </xwalk:result>
          <xwalk:else>
            <xwalk:result>
              <xwalk:field-source subfield="ora_dataset:dataset">
              <xwalk:field-source from="location" subfield="ora_dataset:physical_storage_location"/>
            </xwalk:field-source>
            </xwalk:result>
          </xwalk:else>
        </xwalk:if>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <xwalk:field-map name="confidential-report-markup">
      <xwalk:include-field-map name="common-fields-map">
      <xwalk:exclude-field-mapping to="genre" />
    </xwalk:include-field-map>
      
      <xwalk:field-mapping to="genre">
        <xwalk:field-source subfield="@type" value="type_of_work"/>
          <xwalk:field-source from="object.type" value-map="ora-work-type-mappings"/>

      </xwalk:field-mapping>
<xwalk:field-mapping to="genre">
                <xwalk:field-source subfield="@type" value="sub_type_of_work"/>
          <xwalk:field-source value="Confidential report"/>
          </xwalk:field-mapping>


    </xwalk:field-map>

    <xwalk:field-map name="software-markup">
      <xwalk:include-field-map name="common-fields-map"/>
      <xwalk:include-field-map name="dataset-markup"/>
    <xwalk:field-mapping to="extension">
        <xwalk:if>
          <!-- TODO: Check item type -->
          <xwalk:condition operator="and">
            <xwalk:condition argument-field="object.type" operator="equals">dataset</xwalk:condition>
            <xwalk:condition argument-field="/api:push-object/api:object/api:view/api:field[@name='doi']/api:text" operator="has-value" select-using="xpath"/>
          </xwalk:condition>
          <xwalk:result>
             <xwalk:field-source subfield="ora_dataset:dataset">
            <xwalk:field-source from="location" subfield="ora_dataset:digital_storage_location"/>
            <xwalk:field-source from="version" subfield="dc:version"/>
          </xwalk:field-source>
          </xwalk:result>
          <xwalk:else>
            <xwalk:result>
               <xwalk:field-source subfield="ora_dataset:dataset">
              <xwalk:field-source from="location" subfield="ora_dataset:physical_storage_location"/>
              <xwalk:field-source from="version" subfield="dc:version"/>
            </xwalk:field-source>
            </xwalk:result>
          </xwalk:else>
        </xwalk:if>
      </xwalk:field-mapping>
     
    </xwalk:field-map>

   



    <xwalk:field-map name="thesis-markup">
      <xwalk:include-field-map name="common-fields-map"/>
      <xwalk:field-mapping to="extension">
        <xwalk:field-source subfield="uketd_dc:uketddc">
          <xwalk:field-source from="thesis-type" subfield="uketdterms:qualificationlevel"/>
        </xwalk:field-source>
      </xwalk:field-mapping>
    </xwalk:field-map>
    <!-- ACCESS CONDITION FIELDS -->
    <xwalk:field-map name="access-conditions">
      <xwalk:field-mapping to="accessCondition">
        <xwalk:field-source subfield="@type" value="licence"/>
        <xwalk:field-source from="requested-reuse-licence.short-name"/>
      </xwalk:field-mapping>
      <xwalk:field-mapping to="accessCondition">
        <xwalk:field-source subfield="@type" value="record_ora_deposit_licence"/>
        <xwalk:field-source from="deposit-licence.identifier"/>
      </xwalk:field-mapping>
    </xwalk:field-map>
  </xwalk:field-maps>
  <!-- Named mappings of values between Elements and the destination system -->
  <xwalk:value-maps>
    <!-- Maps Elements item identifier schemes to the appropriate destination value, if known,
    otherwise passes through unchanged -->
    <xwalk:value-map name="identifier-type">
      <xwalk:value-mapping from="pubmed" to="pmid"/>
      <xwalk:value-mapping from="isidoc" to="isidoc"/>
      <xwalk:otherwise-mapping action="continue"/>
    </xwalk:value-map>
    <!-- Maps Elements author identifier schemes to the appropriate destination value, if known,
    otherwise passes through unchanged -->
    <xwalk:value-map name="contributor-identifier-scheme">
      <xwalk:value-mapping from="orcid" to="orcid_identifier"/>
      <xwalk:value-mapping from="email-address" to="email_address"/>
      <xwalk:otherwise-mapping action="continue"/>
    </xwalk:value-map>
    <!-- Processes an article number string, extracting the main part -->
    <xwalk:value-map matchMode="regex" name="parse-article-number">
      <xwalk:value-mapping from="^(?:ARTN ?)?(?:0+)(.+?)$" to="$1"/>
      <xwalk:otherwise-mapping action="continue"/>
    </xwalk:value-map>
    <xwalk:value-map name="ora-work-type-mappings">
      <!-- TODO - Update these type names to be correct -->
      <xwalk:value-mapping from="book" to="Book"/>
      <xwalk:value-mapping from="scholarly-edition" to="Book"/>
      <xwalk:value-mapping from="c-book" to="Book"/>
      <xwalk:value-mapping from="c-translation" to="Book"/>
      <xwalk:value-mapping from="chapter" to="Book section"/>
      <xwalk:value-mapping from="composition" to="Composition"/>
      <xwalk:value-mapping from="performance" to="Composition"/>
      <xwalk:value-mapping from="conference" to="Conference item"/>
      <xwalk:value-mapping from="dataset" to="Dataset"/>
      <xwalk:value-mapping from="exhibition" to="Conference item"/>
      <xwalk:value-mapping from="presentation" to="Conference item"/>
      <xwalk:value-mapping from="poster" to="Conference item"/>
      <xwalk:value-mapping from="fileset" to="Dataset"/>
      <xwalk:value-mapping from="media" to="Dataset"/>
      <xwalk:value-mapping from="figure" to="Dataset"/>
      <xwalk:value-mapping from="software" to="Dataset"/>
      <xwalk:value-mapping from="design" to="Dataset"/>
      <xwalk:value-mapping from="c-ephemera" to="Ephemera"/>
      <xwalk:value-mapping from="internet-publication" to="Internet publication"/>
      <xwalk:value-mapping from="journal-article" to="Journal article"/>
      <xwalk:value-mapping from="patent" to="Patent"/>
      <xwalk:value-mapping from="artefact" to="Physical object"/>
      <xwalk:value-mapping from="c-device-product" to="Physical object"/>
      <xwalk:value-mapping from="report" to="Report"/>
      <xwalk:value-mapping from="thesis-dissertation" to="Thesis"/>
      <xwalk:value-mapping from="c-report" to="Working paper"/>
      <!-- for type Complete sample data'-->
      <xwalk:value-mapping from="c-journal-article-cloned" to="Universal Test Object"/>
      <xwalk:value-mapping from="other" to="Record"/>
      <xwalk:otherwise-mapping to="Unknown"/>
      <!--<xwalk:otherwise-mapping action="ignore-this-value"/>-->
    </xwalk:value-map>
    <xwalk:value-map name="hyrax-work-type-mappings">
      <xwalk:value-mapping from="book" to="Book"/>
      <xwalk:value-mapping from="scholarly-edition" to="Book"/>
      <xwalk:value-mapping from="c-book" to="Book"/>
      <xwalk:value-mapping from="c-translation" to="Book"/>
      <xwalk:value-mapping from="chapter" to="BookSection"/>
      <xwalk:value-mapping from="composition" to="Composition"/>
      <xwalk:value-mapping from="dataset" to="Dataset"/>
      <xwalk:value-mapping from="performance" to="Composition"/>
      <xwalk:value-mapping from="conference" to="ConferenceItem"/>
      <xwalk:value-mapping from="conference paper" to="ConferenceItem"/>
      <xwalk:value-mapping from="exhibition" to="ConferenceItem"/>
      <xwalk:value-mapping from="presentation" to="ConferenceItem"/>
      <xwalk:value-mapping from="poster" to="ConferenceItem"/>
      <xwalk:value-mapping from="fileset" to="Dataset"/>
      <xwalk:value-mapping from="media" to="Dataset"/>
      <xwalk:value-mapping from="figure" to="Dataset"/>
      <xwalk:value-mapping from="software" to="Dataset"/>
      <xwalk:value-mapping from="design" to="Dataset"/>
      <xwalk:value-mapping from="c-ephemera" to="Ephemera"/>
      <xwalk:value-mapping from="internet-publication" to="InternetPublication"/>
      <xwalk:value-mapping from="journal-article" to="JournalArticle"/>
      <xwalk:value-mapping from="patent" to="Patent"/>
      <xwalk:value-mapping from="artefact" to="PhysicalObject"/>
      <xwalk:value-mapping from="c-device-product" to="PhysicalObject"/>
      <xwalk:value-mapping from="report" to="Report"/>
      <xwalk:value-mapping from="thesis-dissertation" to="Thesis"/>
      <xwalk:value-mapping from="working-paper" to="WorkingPaper"/>
      <!-- for type Complete sample data'-->
      <xwalk:value-mapping from="c-journal-article-cloned" to="UniversalTestObject"/>
      <!-- the blow is temorary - will be replaced by 
      <xwalk:value-mapping from="other" to="Record"/> -->
      <xwalk:value-mapping from="other" to="UniversalTestObject"/>
      <xwalk:otherwise-mapping to="Unknown"/>
      <!--<xwalk:otherwise-mapping action="ignore-this-value"/>-->
    </xwalk:value-map>
    <xwalk:value-map name="ora-subtype-work-mappings-from-type">
      <xwalk:value-mapping from="scholarly-edition" to="Scholarly edition"/>
      <xwalk:value-mapping from="c-book" to="Edited book"/>
      <xwalk:value-mapping from="chapter" to="Chapter"/>
      <xwalk:value-mapping from="software" to="Software"/>
      <xwalk:value-mapping from="performance" to="Performance"/>
      <xwalk:value-mapping from="design" to="Design"/>
      <xwalk:value-mapping from="artefact" to="Artefact"/>
      <xwalk:value-mapping from="exhibition" to="Exhibition"/>
      <xwalk:value-mapping from="media" to="Media"/>
      <xwalk:value-mapping from="c-translation" to="Translation"/>
      <xwalk:value-mapping from="poster" to="Poster"/>
      <xwalk:value-mapping from="presentation" to="Presentation"/>
      <xwalk:value-mapping from="figure" to="Media"/>
      <xwalk:value-mapping from="fileset" to="Fileset"/>

      <!--end additionals>-->
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map name="ora-subtype-work-mappings-from-subtype">
      <xwalk:value-mapping from="Editorial Comment" to="Editorial"/>
      <xwalk:value-mapping from="Review" to="Review"/>
      <xwalk:value-mapping from="Rapid Communication" to="Correspondence"/>
      <xwalk:value-mapping from="Addendum" to="Addendum"/>
      <xwalk:value-mapping from="Corrigendum" to="Corrigendum"/>
      <xwalk:value-mapping from="Letter" to="Letter"/>
      <xwalk:value-mapping from="Erratum" to="Erratum"/>
      <xwalk:value-mapping from="Abstract" to="Abstract"/>
      <xwalk:value-mapping from="Comment" to="Comment"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map data-part="identifier:scheme" name="remove-irrelevant-identifiers">
      <xwalk:value-mapping action="ignore-this-value" from="figshare-for-institutions-user-id"/>
      <!-- Email address handled separately, so remove it from the general "identifiers" -->
      <xwalk:value-mapping action="ignore-this-value" from="email-address"/>
      <xwalk:otherwise-mapping action="continue"/>
    </xwalk:value-map>
    <xwalk:value-map name="depositor-type-to-role">
      <xwalk:value-mapping from="impersonated-user" to="Depositor"/>
      <xwalk:value-mapping from="impersonating-user" to="Impersonator"/>
      <xwalk:value-mapping from="user" to="Depositor"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map name="is-deposit-related">
      <xwalk:value-mapping from="impersonated-user"/>
      <xwalk:value-mapping from="impersonating-user"/>
      <xwalk:value-mapping from="user"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map name="is-impersonating-to-role">
      <xwalk:value-mapping from="true" to="Impersonator"/>
      <xwalk:otherwise-mapping to="Depositor"/>
    </xwalk:value-map>
    <xwalk:value-map data-part="relationship:other-object-category" name="publication-relationships">
      <xwalk:value-mapping action="continue" from="publication"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map data-part="relationship:other-object-category" name="grant-relationships">
      <xwalk:value-mapping action="continue" from="grant"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
      <xwalk:value-map name="publication-status">
      <!--Where they don't change, have left in anyway to use the 'ignore' option for other values-->
      <xwalk:value-mapping from="Unpublished" to="Not published"/>
      <xwalk:value-mapping from="Submitted" to="Submitted"/>
      <xwalk:value-mapping from="Accepted" to="Accepted"/>
      <xwalk:value-mapping from="Published online" to="Published"/>
      <xwalk:value-mapping from="Published" to="Published"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>
    <xwalk:value-map name="file-versions">
      <xwalk:value-mapping from="Accepted version" to="AM"/>
      <xwalk:value-mapping from="Submitted version" to="SMUR"/>
      <xwalk:value-mapping from="Published version" to="VoR"/>
      <xwalk:otherwise-mapping to="NA"/>
    </xwalk:value-map>

 <xwalk:value-map name="licences">
      <xwalk:value-mapping from="CC BY" to="CC Attribution (CC BY)" />
      <xwalk:value-mapping from="CC BY-ND" to="CC Attribution-NoDerivatives (CC BY-ND)" />
      <xwalk:value-mapping from="CC BY-SA" to="CC Attribution-ShareAlike (CC BY-SA)"/>
      <xwalk:value-mapping from="CC BY-NC" to="CC Attribution-NonCommercial (CC BY-NC)"/>
      <xwalk:value-mapping from="CC BY-NC-ND" to="CC Attribution-NonCommercial-NoDerivatives (CC BY-NC-ND)"/>
      <xwalk:value-mapping from="CC BY-NC-SA" to="CC Attribution-NonCommercial-ShareAlike (CC BY-NC-SA)"/>
      <xwalk:value-mapping from="Publisher's own licence" to="Other"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>

    <xwalk:value-map name="apc">
      <xwalk:value-mapping from="Yes" to="yes"/>
      <xwalk:value-mapping from="No" to="no"/>
      <xwalk:otherwise-mapping action="ignore-this-value"/>
    </xwalk:value-map>


  </xwalk:value-maps>
  <!-- Selects which field map to use -->
  <xwalkout:field-map-selector>
    <xwalk:choose>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">journal-article</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="journal-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition operator="or">
        <xwalk:condition argument-field="object.type" operator="equals">book</xwalk:condition>
        <xwalk:condition argument-field="object.type" operator="equals">chapter</xwalk:condition>
        </xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="book-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">c-device-product</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="device-product-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">patent</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="patent-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">thesis-dissertation</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="thesis-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">software</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="software-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:when>
        <xwalk:condition argument-field="object.type" operator="equals">dataset</xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="dataset-markup"/>
        </xwalk:result>
      </xwalk:when>
       <xwalk:when>
        <xwalk:condition operator="and">
        <xwalk:condition argument-field="object.type" operator="equals">report</xwalk:condition>
        <xwalk:condition argument-field="/api:push-object/api:object/api:view/api:field[@name='confidential']/api:boolean" operator = "equals" select-using="xpath">true</xwalk:condition>
      </xwalk:condition>
        <xwalk:result>
          <xwalk:field-map-selection field-map="confidential-report-markup"/>
        </xwalk:result>
      </xwalk:when>
      <xwalk:otherwise>
        <xwalk:result>
          <xwalk:field-map-selection field-map="common-fields-map"/>
        </xwalk:result>
      </xwalk:otherwise>
    </xwalk:choose>
  </xwalkout:field-map-selector>
</xwalkout:consolidated-maps>
